<clr-datagrid [clrDgLoading]="loading" (clrDgRefresh)="onRefresh($event)">
    <clr-dg-action-bar> <ng-content select="[action-bar]"></ng-content> </clr-dg-action-bar>
    <clr-dg-column
        *ngFor="let col of table?.cols; trackBy: trackByCol"
        [class.sortable]="col.sort"
        [clrDgField]="getColSort(col)"
    >
        {{ col.title }}
    </clr-dg-column>

    <clr-dg-row *ngIf="aggregateRow" class="aggregate-row">
        <clr-dg-cell *ngFor="let col of table?.cols; trackBy: trackByCol"> {{ getAggrColValue(col) }} </clr-dg-cell>
    </clr-dg-row>

    <clr-dg-row
        *ngFor="let row of rows; trackBy: trackByRow"
        [class.active-row]="isRowActive(row)"
        [clrDgItem]="row.id"
    >
        <clr-dg-cell *ngFor="let cell of table?.cols; trackBy: trackByCol">
            <ng-container *ngTemplateOutlet="rowCell; context: { cell: cell, row: row }"></ng-container>
        </clr-dg-cell>

        <!-- Details -->

        <ng-container *ngIf="row.details">
            <ng-container ngProjectAs="clr-dg-row-detail" *ngFor="let detail of row.details; trackBy: trackByRow">
                <clr-dg-row-detail *clrIfExpanded>
                    <!-- Details in columns -->
                    <ng-container *ngIf="row.details.cols; else detailsCard">
                        <clr-dg-cell *ngFor="let cell of row.details.cols; trackBy: trackByCol">
                            <ng-container *ngTemplateOutlet="rowCell; context: { cell: cell, row: row }"></ng-container>
                        </clr-dg-cell>
                    </ng-container>
                    <!-- Details in card -->
                    <ng-template #detailsCard>
                        <ng-container
                            *ngTemplateOutlet="detailTemplate; context: { $implicit: detail, row: row }"
                        ></ng-container>
                    </ng-template>
                </clr-dg-row-detail>
            </ng-container>
        </ng-container>
    </clr-dg-row>

    <!-- Paginatore -->

    <clr-dg-footer *ngIf="paginator">
        {{ pagination.firstItem + 1 }} - {{ pagination.lastItem + 1 }} / {{ paginator.length }}
        <hlc-select
            *ngIf="paginatorItems"
            class="page-size-selector"
            [naked]="true"
            [disallowEmpty]="true"
            [value]="paginator.pageSize"
            (valueChange)="onPageSizeChanged($event)"
            [items]="paginatorItems"
        ></hlc-select>
        <clr-dg-pagination
            #pagination
            [clrDgPageSize]="paginator.pageSize"
            [clrDgPage]="paginator.pageIndex"
            [clrDgTotalItems]="paginator.length"
        >
        </clr-dg-pagination>
    </clr-dg-footer>
</clr-datagrid>

<ng-template #rowCell let-cell="cell" let-row="row">
    <!-- regular cell -->
    <ng-template [ngIf]="!cell.kind && !cell.customCell">
        <span [ngClass]="getCellClass(cell, row)"> {{ getCellDisplayValue(cell, row) }} </span>
    </ng-template>
    <!-- custom cell -->
    <ng-template [ngIf]="cell.customCell">
        <ng-container
            [hlcTableCustomCellHost]="cell"
            [hlcTableCustomCellHostDirective]="getCustomCellDirective(cell)"
            [hlcTableCustomCellHostRow]="row"
        >
        </ng-container>
    </ng-template>
    <!-- map cell -->
    <ng-template [ngIf]="cell.kind">
        <ng-container
            [hlcTableCellHost]="cell"
            [hlcTableCellHostComponentType]="getCellComponentType(cell)"
            [hlcTableCellHostRow]="row"
        >
        </ng-container>
    </ng-template>
</ng-template>
